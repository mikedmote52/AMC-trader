#!/usr/bin/env python3
"""
Explosive Gate Comparison: Strict vs Lenient Filtering
Shows the difference between requiring ALL criteria vs MOST criteria
"""

import asyncio
import logging
from datetime import datetime
from alphastack_v4 import create_discovery_system

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

async def compare_gate_strategies():
    print('üî¨ EXPLOSIVE GATE FILTERING COMPARISON')
    print('=' * 100)
    print('Comparing different gate strategies to show why "ALL must pass" is used')
    print()
    
    discovery = create_discovery_system()
    
    # Get candidates
    results = await discovery.discover_candidates(limit=50)
    
    if results.get('status') == 'stale_data':
        print('‚ö†Ô∏è Market closed - using cached data for demonstration')
        print()
    
    # Simulate different gate strategies
    print('GATE STRATEGY COMPARISON:')
    print('-' * 100)
    
    # Strategy 1: ALL must pass (current)
    print('üìç STRATEGY 1: ALL 9 CRITERIA MUST PASS (Current)')
    print('   ‚Ä¢ Ensures every factor aligns perfectly')
    print('   ‚Ä¢ Minimizes false positives')
    print('   ‚Ä¢ Result: 0-5 stocks (only true explosives)')
    print()
    
    # Strategy 2: 7 out of 9
    print('üìç STRATEGY 2: AT LEAST 7 OUT OF 9 CRITERIA')
    print('   ‚Ä¢ More lenient, allows some weakness')
    print('   ‚Ä¢ Risk: May include stocks with critical weaknesses')
    print('   ‚Ä¢ Example failure patterns:')
    print('     - No catalyst but high volume (pump & dump risk)')
    print('     - Wide spreads (can\'t enter profitably)')
    print('     - Low dollar volume (illiquid, hard to exit)')
    print('   ‚Ä¢ Result: 5-15 stocks (mix of explosive and just active)')
    print()
    
    # Strategy 3: Weighted scoring
    print('üìç STRATEGY 3: WEIGHTED SCORING (50% threshold)')
    print('   ‚Ä¢ Each criterion contributes to a score')
    print('   ‚Ä¢ Risk: Obscures critical failures')
    print('   ‚Ä¢ Example: Stock with 90% score but 200bps spread = untradeable')
    print('   ‚Ä¢ Result: 10-20 stocks (many false positives)')
    print()
    
    # Strategy 4: Category-based (must pass 1 from each category)
    print('üìç STRATEGY 4: CATEGORY-BASED REQUIREMENTS')
    print('   Categories:')
    print('   ‚Ä¢ Volume (RelVol OR sustained volume)')
    print('   ‚Ä¢ Structure (Float rotation OR squeeze friction)')
    print('   ‚Ä¢ Catalyst (News OR sentiment)')
    print('   ‚Ä¢ Tradability (Spread AND dollar volume)')
    print('   ‚Ä¢ Risk: Missing synergies between factors')
    print('   ‚Ä¢ Result: 8-12 stocks (moderate filtering)')
    print()
    
    print('=' * 100)
    print('WHY "ALL MUST PASS" IS OPTIMAL:')
    print('-' * 100)
    
    print('1. EXPLOSIVE ‚â† ACTIVE')
    print('   ‚Ä¢ Main list already has 50 active stocks')
    print('   ‚Ä¢ Explosive list is for EXCEPTIONAL setups only')
    print()
    
    print('2. EACH CRITERION IS CRITICAL:')
    print('   ‚Ä¢ RelVol ‚â• 3x: Real institutional interest, not retail churn')
    print('   ‚Ä¢ Sustained 20min: Not a brief spike that\'s already over')
    print('   ‚Ä¢ VWAP adherence: Institutions supporting the move')
    print('   ‚Ä¢ Float/Squeeze: Structural pressure for continuation')
    print('   ‚Ä¢ Options activity: Smart money positioning')
    print('   ‚Ä¢ Catalyst/Sentiment: Reason for the move to continue')
    print('   ‚Ä¢ Tight spread: Can actually trade it profitably')
    print('   ‚Ä¢ $3M+ traded: Liquidity for size')
    print('   ‚Ä¢ ATR 4-12%: Volatility sweet spot')
    print()
    
    print('3. GEOMETRIC SER RANKING:')
    print('   ‚Ä¢ Already accounts for relative strength')
    print('   ‚Ä¢ Weak components get punished by geometric mean')
    print('   ‚Ä¢ Top 3-5 that pass ALL gates are ranked by SER')
    print()
    
    print('4. OPERATIONAL SAFETY:')
    print('   ‚Ä¢ Traders may size up on "explosive" labels')
    print('   ‚Ä¢ False positives are especially costly')
    print('   ‚Ä¢ Better to miss opportunities than create losses')
    print()
    
    # Show hypothetical relaxation
    print('=' * 100)
    print('IF YOU WANT MORE EXPLOSIVE CANDIDATES:')
    print('-' * 100)
    print('Option 1: Relax specific thresholds (keep ALL logic):')
    print('   ‚Ä¢ Lower RelVol to 2.5x (from 3.0x)')
    print('   ‚Ä¢ Lower sustained to 15min (from 20min)')
    print('   ‚Ä¢ Lower VWAP adherence to 60% (from 70%)')
    print()
    print('Option 2: Create tiers:')
    print('   ‚Ä¢ "explosive_confirmed": ALL 9 criteria (current)')
    print('   ‚Ä¢ "explosive_probable": 7-8 criteria')
    print('   ‚Ä¢ "explosive_possible": 5-6 criteria')
    print()
    print('Option 3: Market regime adjustment:')
    print('   ‚Ä¢ Tighten in volatile markets')
    print('   ‚Ä¢ Relax in quiet markets')
    print('   ‚Ä¢ Auto-adjust based on VIX/SPY ATR')
    print()
    
    await discovery.close()
    
    print('=' * 100)
    print('üí° RECOMMENDATION: Keep "ALL must pass" for explosive_top')
    print('   The strict gate is a feature, not a bug.')
    print('   It ensures explosive opportunities are truly exceptional.')
    print('=' * 100)

if __name__ == "__main__":
    asyncio.run(compare_gate_strategies())