<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC-TRADER Frontend API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #0f0; }
        .pass { background: #002200; }
        .fail { background: #220000; color: #f00; }
        pre { overflow-x: auto; }
    </style>
</head>
<body>
    <h1>AMC-TRADER Frontend API Test</h1>
    <div id="results"></div>

    <script>
        const API_BASE = "https://amc-trader.onrender.com";
        const results = document.getElementById('results');

        function log(message, data, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'test fail' : 'test pass';
            div.innerHTML = `<strong>${message}</strong>`;
            if (data) {
                div.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            results.appendChild(div);
        }

        async function runTests() {
            // Test 1: Backend health
            try {
                const healthRes = await fetch(`${API_BASE}/health`);
                const health = await healthRes.json();
                log('✅ Backend Health Check', health);
            } catch (e) {
                log('❌ Backend Health Check Failed', e.message, true);
            }

            // Test 2: Discovery contenders
            try {
                const contendersRes = await fetch(`${API_BASE}/discovery/contenders`);
                const contenders = await contendersRes.json();
                log(`✅ Discovery Contenders: ${contenders.count || contenders.length} candidates`, {
                    count: contenders.count || contenders.length,
                    first: contenders.data?.[0] || contenders[0],
                    source: contenders.source,
                    engine: contenders.engine
                });
            } catch (e) {
                log('❌ Discovery Contenders Failed', e.message, true);
            }

            // Test 3: Simulate frontend fetchContenders
            try {
                const response = await fetch(`${API_BASE}/discovery/contenders`);
                const json = await response.json();
                const data = json.data || json; // Handle both formats
                const candidates = Array.isArray(data) ? data : [];

                log(`✅ Frontend fetchContenders Simulation: ${candidates.length} candidates`, {
                    totalCount: candidates.length,
                    topThree: candidates.slice(0, 3).map(c => ({
                        symbol: c.symbol || c.ticker,
                        score: c.score,
                        action: c.action_tag
                    }))
                });
            } catch (e) {
                log('❌ Frontend Simulation Failed', e.message, true);
            }

            // Test 4: Check score distribution
            try {
                const response = await fetch(`${API_BASE}/discovery/contenders`);
                const json = await response.json();
                const data = json.data || json;
                const candidates = Array.isArray(data) ? data : [];

                const scoreRanges = {
                    'Trade-ready (≥75)': candidates.filter(c => c.score >= 75).length,
                    'Watchlist (70-75)': candidates.filter(c => c.score >= 70 && c.score < 75).length,
                    'Monitoring (<70)': candidates.filter(c => c.score < 70).length
                };

                log('✅ Score Distribution Analysis', scoreRanges);
            } catch (e) {
                log('❌ Score Analysis Failed', e.message, true);
            }
        }

        runTests();
    </script>
</body>
</html>